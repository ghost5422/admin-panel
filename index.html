<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Admin Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
  font-family: 'Poppins', sans-serif;
  background: #eef2f7;
  padding: 20px;
  color: #1a1a1a;
}
h1 {
  color: #2c3e50;
  margin-top: 30px;
  border-bottom: 2px solid #ccc;
  padding-bottom: 10px;
}
.form-group {
  margin-bottom: 15px;
}
label {
  display: block;
  font-weight: 600;
  margin-bottom: 5px;
}
input, button {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 16px;
  box-sizing: border-box;
}
button {
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s ease;
}
.submit-btn {
  background: #007bff;
  color: white;
  border: none;
  margin-top: 10px;
}
.submit-btn:hover {
  background: #1565c0;
}
.card {
  background: white;
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.card strong {
  display: block;
  margin-bottom: 5px;
  font-size: 18px;
}
.actions {
  margin-top: 10px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.delete-btn, .confirm-btn {
  border: none;
  border-radius: 5px;
  padding: 8px 12px;
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}
.delete-btn {
  background: #dc3545;
  color: white;
}
.delete-btn:hover {
  background: #c62828;
}
.confirm-btn {
  background: #28a745;
  color: white;
}
.confirm-btn:hover {
  background: #388e3c;
}
.status {
  margin-top: 8px;
  font-weight: bold;
}
.status.pending {
  color: orange;
}
.status.ready {
  color: green;
}
.icon {
  margin-right: 5px;
}
  </style>
</head>
<body>

  <h1>ğŸ½ï¸ MenÃ¼ Ekle</h1>
  <div class="form-group">
    <label>Yemek AdÄ±</label>
    <input type="text" id="food-name" placeholder="Ã–rn: Lahmacun">
  </div>
  <div class="form-group">
    <label>Fiyat (â‚º)</label>
    <input type="number" id="food-price" placeholder="Ã–rn: 50">
  </div>
  <button class="submit-btn" onclick="addMenuItem()"><i class="fas fa-plus icon"></i>MenÃ¼ye Ekle</button>

  <h1>ğŸ“‹ MenÃ¼ Listesi</h1>
  <div id="menu-list">YÃ¼kleniyor...</div>

  <h1>ğŸ“¦ Gelen SipariÅŸler</h1>
  <div id="orders-list">YÃ¼kleniyor...</div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCDNbgKzJdBKEZUnWH09Az6ZCwUefWJXhY",
      authDomain: "onlinesiparis-2cf91.firebaseapp.com",
      projectId: "onlinesiparis-2cf91",
      storageBucket: "onlinesiparis-2cf91.appspot.com",
      messagingSenderId: "366801664755",
      appId: "1:366801664755:web:57b577f1943ebdf1ab8c85",
      databaseURL: "https://onlinesiparis-2cf91-default-rtdb.europe-west1.firebasedatabase.app"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function addMenuItem() {
      const name = document.getElementById("food-name").value.trim();
      const price = document.getElementById("food-price").value.trim();
      if (!name || !price) {
        Swal.fire({ icon: 'warning', title: 'UyarÄ±', text: 'LÃ¼tfen tÃ¼m alanlarÄ± doldurun.' });
        return;
      }

      const newRef = db.ref("menu").push();
      newRef.set({ name, price: parseFloat(price) }).then(() => {
        Swal.fire({ icon: 'success', title: 'BaÅŸarÄ±lÄ±!', text: 'Yemek menÃ¼ye eklendi.' });
        document.getElementById("food-name").value = "";
        document.getElementById("food-price").value = "";
      });
    }

    const menuList = document.getElementById("menu-list");
    db.ref("menu").on("value", (snapshot) => {
      menuList.innerHTML = "";
      if (!snapshot.exists()) {
        menuList.innerHTML = "MenÃ¼ boÅŸ.";
        return;
      }
      snapshot.forEach((child) => {
        const item = child.val();
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <strong>${item.name}</strong>
          <div>Fiyat: â‚º${item.price}</div>
          <div class="actions">
            <button class="confirm-btn" onclick="editItem('${child.key}', '${item.name}', ${item.price})"><i class="fas fa-pen icon"></i>DÃ¼zenle</button>
            <button class="delete-btn" onclick="deleteItem('${child.key}')"><i class="fas fa-trash icon"></i>Sil</button>
          </div>
        `;
        menuList.appendChild(div);
      });
    });

    function deleteItem(id) {
      Swal.fire({
        title: 'Emin misin?',
        text: 'Bu Ã¶ÄŸeyi silmek istiyor musun?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Evet, sil',
        cancelButtonText: 'VazgeÃ§'
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref("menu/" + id).remove();
          Swal.fire('Silindi!', 'ÃœrÃ¼n silindi.', 'success');
        }
      });
    }

    function editItem(id, currentName, currentPrice) {
      Swal.fire({
        title: 'Yeni ÃœrÃ¼n AdÄ±',
        input: 'text',
        inputValue: currentName,
        showCancelButton: true,
        confirmButtonText: 'Devam et',
        cancelButtonText: 'Ä°ptal'
      }).then((nameResult) => {
        if (!nameResult.isConfirmed || !nameResult.value.trim()) return;

        const newName = nameResult.value.trim();
        Swal.fire({
          title: 'Yeni Fiyat (â‚º)',
          input: 'number',
          inputValue: currentPrice,
          showCancelButton: true,
          confirmButtonText: 'GÃ¼ncelle',
          cancelButtonText: 'Ä°ptal'
        }).then((priceResult) => {
          if (!priceResult.isConfirmed || isNaN(priceResult.value)) {
            Swal.fire('Hata', 'GeÃ§erli bir fiyat girin.', 'error');
            return;
          }

          db.ref("menu/" + id).update({
            name: newName,
            price: parseFloat(priceResult.value)
          }).then(() => {
            Swal.fire('BaÅŸarÄ±lÄ±!', 'ÃœrÃ¼n gÃ¼ncellendi.', 'success');
          });
        });
      });
    }

    const ordersDiv = document.getElementById("orders-list");
    db.ref("orders").on("value", (snapshot) => {
      ordersDiv.innerHTML = "";
      if (!snapshot.exists()) {
        ordersDiv.innerHTML = "<div class='card'>HenÃ¼z sipariÅŸ yok.</div>";
        return;
      }

      snapshot.forEach((child) => {
        const order = child.val();
        const card = document.createElement("div");
        card.className = "card";
        card.style.marginBottom = "15px";

        let items = "";
        let total = 0;
        order.items.forEach(item => {
          const subtotal = item.price * item.quantity;
          total += subtotal;
          items += `â€¢ ${item.name} x${item.quantity} - â‚º${subtotal}<br>`;
        });

        const note = order.note ? `<br><strong>Not:</strong> ${order.note}` : "";

        const status = order.status === "onaylandÄ±"
          ? `<div class="status ready">âœ… SipariÅŸ HazÄ±r</div>`
          : `<div class="status pending">â³ Onay bekleniyor</div>`;

        card.innerHTML = `
          <strong>${order.name} (${order.phone})</strong><br>
          ${items}
          <strong>Toplam: â‚º${total}</strong><br>
          <em>${order.date}</em>${note}
          <div class="actions">
            <button class="confirm-btn" onclick="onaylaSiparis('${child.key}')" ${order.status === "onaylandÄ±" ? "disabled" : ""}>
              ${order.status === "onaylandÄ±" ? "HazÄ±r" : "Onayla"}
            </button>
            <button class="delete-btn" onclick="deleteOrder('${child.key}')">Sil</button>
          </div>
          ${status}
        `;

        ordersDiv.appendChild(card);
      });
    });

    function deleteOrder(id) {
      Swal.fire({
        title: 'Emin misin?',
        text: 'Bu sipariÅŸi silmek istiyor musun?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Evet, sil',
        cancelButtonText: 'VazgeÃ§'
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref("orders/" + id).remove();
          Swal.fire('Silindi!', 'SipariÅŸ silindi.', 'success');
        }
      });
    }

    function onaylaSiparis(id) {
      db.ref("orders/" + id).update({ status: "onaylandÄ±" });
      Swal.fire('SipariÅŸ OnaylandÄ±!', '', 'success');
    }
  </script>
 <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>

<script>
  const messaging = firebase.messaging();

  navigator.serviceWorker.register('/firebase-messaging-sw.js').then((registration) => {
    messaging.useServiceWorker(registration);

    Notification.requestPermission().then((permission) => {
      if (permission === 'granted') {
        messaging.getToken({
          vapidKey: "BA4BGGkfenMbP1QsbzVehQs9aJZQux71dqS59ZB-p8sgR3kLbzVCjIOPX_NYfzgvcUIG7nsFrrWyOJ3ES1Gf4NU"
        }).then((token) => {
          console.log("âœ… FCM TOKEN:", token);
        }).catch((err) => {
          console.warn("âŒ Token alÄ±namadÄ±:", err);
        });
      } else {
        console.warn("ğŸ”• Bildirim izni reddedildi.");
      }
    });
  }).catch((err) => {
    console.error("ğŸš« Service Worker kaydÄ± baÅŸarÄ±sÄ±z:", err);
  });
</script>
<div style="margin-top: 30px;">
  <h1>ğŸ”’ Sistem Durumu</h1>
  <button id="toggleButton" class="submit-btn" onclick="toggleSystem()">Durum YÃ¼kleniyor...</button>
</div>

<script>
  const toggleButton = document.getElementById("toggleButton");

  function toggleSystem() {
    const newStatus = toggleButton.innerText === "Åu Anda: AÃ§Ä±k (Kapat)" ? "kapali" : "acik";
    db.ref("sistemDurumu").set({ durum: newStatus });
  }

  db.ref("sistemDurumu").on("value", (snapshot) => {
    const durum = snapshot.val()?.durum || "acik";
    if (durum === "kapali") {
      toggleButton.innerText = "Åu Anda: KapalÄ± (AÃ§)";
      toggleButton.style.background = "#e53935";
    } else {
      toggleButton.innerText = "Åu Anda: AÃ§Ä±k (Kapat)";
      toggleButton.style.background = "#43a047";
    }
  });
</script>
</body>
</html>
